<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAKROTEKS Personel Y√∂netimi - Bulut Sistemi</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --primary: #1a73e8; --success: #28a745; --danger: #dc3545; --warning: #ffc107; --info: #17a2b8; }
        body { font-family: 'Segoe UI', sans-serif; margin: 15px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 1400px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .form-grid input, .form-grid select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: #2c3e50; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .status-paid { color: white; background: var(--success); padding: 3px 8px; border-radius: 4px; font-weight: bold; }
        .status-unpaid { color: white; background: var(--danger); padding: 3px 8px; border-radius: 4px; font-weight: bold; }
        .btn-add { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        @media print { .no-print { display: none !important; } .container { box-shadow: none; border: none; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2 style="margin:0">üë§ PERSONEL VE MAA≈û Y√ñNETƒ∞Mƒ∞</h2>
        <div id="status" style="color: green; font-weight: bold;">‚óè Bulut Baƒülantƒ±sƒ± Aktif</div>
    </div>

    <div class="form-grid no-print">
        <input type="text" id="p_ad" placeholder="Personel Adƒ± Soyadƒ±">
        <input type="text" id="p_bolum" placeholder="B√∂l√ºm">
        <input type="number" id="p_maas" placeholder="Maa≈ü (TL)">
        <input type="number" id="p_mesai" placeholder="Mesai (TL)">
        <input type="number" id="p_prim" placeholder="Prim/Bonus (TL)">
        <input type="number" id="p_kesinti" placeholder="Kesinti (TL)">
        <select id="p_durum">
            <option value="√ñdenmedi">√ñdenmedi</option>
            <option value="√ñdendi">√ñdendi</option>
        </select>
        <button class="btn-add" onclick="kaydet()">PERSONEL EKLE</button>
    </div>

    <div class="no-print" style="margin-bottom: 15px; display: flex; gap: 10px;">
        <button onclick="window.print()" style="background:#6c757d; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">Yazdƒ±r / PDF</button>
        <select id="ayFiltre" onchange="listele()" style="padding:5px; border-radius:4px;">
            <option value="Hepsi">T√ºm D√∂nemler</option>
        </select>
    </div>

    <table>
        <thead>
            <tr>
                <th>Ad Soyad</th>
                <th>B√∂l√ºm</th>
                <th>Maa≈ü</th>
                <th>Mesai</th>
                <th>Prim</th>
                <th>Kesinti</th>
                <th>Net √ñdenen</th>
                <th>Durum</th>
                <th class="no-print">ƒ∞≈ülem</th>
            </tr>
        </thead>
        <tbody id="personelBody"></tbody>
    </table>
</div>

<script>
    // Fƒ∞REBASE YAPILANDIRMASI
    const firebaseConfig = {
        apiKey: "AIzaSyB4zJ0nY_06VnOh-JEmpfhw8EzrvbCiIBA",
        authDomain: "texerp-ea015.firebaseapp.com",
        databaseURL: "https://texerp-ea015-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "texerp-ea015",
        storageBucket: "texerp-ea015.firebasestorage.app",
        messagingSenderId: "531851332664",
        appId: "1:531851332664:web:d2af3d69b6241d7fd8eacd"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const personelRef = db.ref("personel_yonetimi");

    // Kayƒ±t Fonksiyonu
    function kaydet() {
        const ad = document.getElementById('p_ad').value;
        const maas = parseFloat(document.getElementById('p_maas').value) || 0;
        if(!ad) return alert("ƒ∞sim giriniz!");

        const donem = new Date().toLocaleDateString('tr-TR', { month: 'long', year: 'numeric' });
        
        personelRef.push({
            ad: ad.toUpperCase(),
            bolum: document.getElementById('p_bolum').value.toUpperCase(),
            maas: maas,
            mesai: parseFloat(document.getElementById('p_mesai').value) || 0,
            prim: parseFloat(document.getElementById('p_prim').value) || 0,
            kesinti: parseFloat(document.getElementById('p_kesinti').value) || 0,
            durum: document.getElementById('p_durum').value,
            donem: donem,
            tarih: Date.now()
        });

        document.querySelectorAll('.form-grid input').forEach(i => i.value = "");
    }

    // Listeleme
    personelRef.on("value", (snap) => {
        const body = document.getElementById('personelBody');
        const ayFiltre = document.getElementById('ayFiltre');
        const mevcutFiltre = ayFiltre.value;
        body.innerHTML = "";
        
        const veriler = snap.val();
        if(!veriler) return;

        const liste = Object.keys(veriler).map(key => ({ id: key, ...veriler[key] }));
        liste.sort((a,b) => b.tarih - a.tarih);

        // Ay filtresini g√ºncelle
        const donemler = [...new Set(liste.map(i => i.donem))];
        ayFiltre.innerHTML = '<option value="Hepsi">T√ºm D√∂nemler</option>';
        donemler.forEach(d => {
            ayFiltre.innerHTML += `<option value="${d}" ${d === mevcutFiltre ? 'selected' : ''}>${d}</option>`;
        });

        liste.forEach(p => {
            if(mevcutFiltre !== "Hepsi" && p.donem !== mevcutFiltre) return;

            const net = (p.maas + p.mesai + p.prim) - p.kesinti;
            const durumCls = p.durum === "√ñdendi" ? "status-paid" : "status-unpaid";

            body.innerHTML += `
                <tr>
                    <td style="text-align:left; font-weight:bold">${p.ad}</td>
                    <td>${p.bolum}</td>
                    <td>${p.maas.toLocaleString()} ‚Ç∫</td>
                    <td>${p.mesai.toLocaleString()} ‚Ç∫</td>
                    <td>${p.prim.toLocaleString()} ‚Ç∫</td>
                    <td>${p.kesinti.toLocaleString()} ‚Ç∫</td>
                    <td style="font-weight:800; color:var(--primary)">${net.toLocaleString()} ‚Ç∫</td>
                    <td><span class="${durumCls}" onclick="durumDegistir('${p.id}', '${p.durum}')" style="cursor:pointer">${p.durum}</span></td>
                    <td class="no-print">
                        <button onclick="sil('${p.id}')" style="background:none; border:none; cursor:pointer; font-size:16px">üóëÔ∏è</button>
                    </td>
                </tr>
            `;
        });
    });

    function durumDegistir(id, mevcut) {
        const yeni = mevcut === "√ñdendi" ? "√ñdenmedi" : "√ñdendi";
        personelRef.child(id).update({ durum: yeni });
    }

    function sil(id) {
        if(confirm("Bu personel kaydƒ± silinecek. Emin misiniz?")) {
            personelRef.child(id).remove();
        }
    }

    function listele() {
        personelRef.once("value", () => {}); // Filtre deƒüi≈üikliƒüinde on("value") zaten tetiklenir.
    }
</script>
</body>
</html>